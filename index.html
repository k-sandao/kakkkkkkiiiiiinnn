<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>課金計算サイト</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background-color:#f0f0f0; }
  h1,h2 { color: #333; }
  .pack-container { display: flex; flex-wrap: wrap; gap: 10px; }
  .pack-card {
    background-color: #fff;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    width: 250px;
    box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
  }
  .pack-card input[type=number] { width: 50px; margin-left:5px; }
  .pack-card label { display:block; margin-bottom:5px; }
  .buttons { margin-top: 15px; }
  button { margin:5px; padding:5px 10px; border-radius:5px; border:none; background-color:#4CAF50; color:white; cursor:pointer; }
  button:hover { background-color:#45a049; }
  .result { margin-top:20px; border-top:2px solid #333; padding-top:10px; background-color:#fff; border-radius:8px; padding:15px; }
  #history { margin-top:10px; }
  .ad-container { margin: 15px 0; text-align:center; }
</style>

<!-- Google AdSenseスクリプト -->
<script data-ad-client="ca-pub-xxxxxxxxxxxxxxxx" async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>
<body>

<h1>課金計算サイト</h1>

<!-- ページ上部広告 -->
<div class="ad-container">
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-xxxxxxxxxxxxxxxx"
       data-ad-slot="1111111111"
       data-ad-format="auto"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

<h2>パック選択</h2>
<div class="pack-container" id="packs"></div>

<div class="buttons">
  <button onclick="selectAll()">全て購入</button>
  <button onclick="calculate()">計算する</button>
  <button onclick="clearHistory()">履歴クリア</button>
</div>

<div class="result" id="result"></div>

<!-- 計算結果下広告 -->
<div class="ad-container">
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-xxxxxxxxxxxxxxxx"
       data-ad-slot="2222222222"
       data-ad-format="auto"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

<h2>購入履歴</h2>
<div id="history"></div>

<script>
const defaultPacks = [
  { name: "魔導石195個パック", price: 7800, paid: 65, free: 130, multiple: false },
  { name: "魔導石120個パック", price: 4800, paid: 40, free: 80, multiple: false },
  { name: "魔導石75個パック", price: 3000, paid: 25, free: 50, multiple: false },
  { name: "魔導石33個パック", price: 1200, paid: 10, free: 23, multiple: false },
  { name: "魔導石25個パック", price: 480, paid: 4, free: 21, multiple: false },
  { name: "追憶の天騎士デュアルシフトガチャクーポンSPパック", price: 2400, paid: 20, free: 0, coupon: 20, multiple: false },
  { name: "月間公式ストアパック55", price: 1200, paid: 10, free: 45, multiple: false },
  { name: "月間公式ストアパック300", price: 18000, paid: 150, free: 150, multiple: false },
  { name: "魔導石26個（公式ストア）", price: 3000, paid: 25, free: 1, multiple: true },
  { name: "魔導石43個（公式ストア）", price: 4800, paid: 40, free: 3, multiple: true },
  { name: "魔導石71個（公式ストア）", price: 7800, paid: 65, free: 6, multiple: true },
  { name: "ギルドイベント応援フルパワーガチャクーポンSPパック", price: 2400, paid: 20, free: 0, coupon: 20, multiple: false },
  { name: "ぷよクエサマー2025ブーストガチャクーポSPパック", price: 2400, paid: 20, free: 0, coupon: 20, multiple: false },
  { name: "魔導石65個", price: 7800, paid: 65, free: 0, multiple: true },
  { name: "魔導石40個", price: 4800, paid: 40, free: 0, multiple: true },
  { name: "魔導石25個", price: 3000, paid: 25, free: 0, multiple: true },
  { name: "魔導石10個", price: 1200, paid: 10, free: 0, multiple: true },
  { name: "魔導石4個", price: 480, paid: 4, free: 0, multiple: true },
  { name: "スタート応援パック", price: 1200, paid: 10, free: 0, multiple: false },
  { name: "育成応援パック", price: 480, paid: 4, free: 0, multiple: false }
];

let packs = [...defaultPacks];
let history = [];

function renderPacks() {
  const container = document.getElementById('packs');
  container.innerHTML = '';
  packs.forEach((pack,index) => {
    let html = `<div class="pack-card">
      <input type="checkbox" id="pack${index}"> <label for="pack${index}"><strong>${pack.name}</strong></label>
      <p>￥${pack.price} | 有償${pack.paid} 無償${pack.free} クーポン${pack.coupon||0}</p>`;
    if(pack.multiple) {
      html += `数量: <input type="number" id="qty${index}" value="1" min="1">`;
    }
    if(pack.coupon && pack.coupon>0){
      html += `<br><input type="checkbox" id="coupon${index}" checked> <label for="coupon${index}">クーポンをパワー計算に含める</label>`;
    }
    html += '</div>';
    container.innerHTML += html;
  });
}

function selectAll(){
  packs.forEach((_,i)=>{
    document.getElementById(`pack${i}`).checked=true;
  });
}

function calculate(){
  let totalPrice=0, totalPaid=0, totalFree=0, totalCoupon=0;
  let paidPower=0, freePower=0, couponPower=0;
  let paidRemainder=0, freeRemainder=0;

  packs.forEach((pack,i)=>{
    const checkbox=document.getElementById(`pack${i}`);
    if(checkbox.checked){
      let qty=1;
      if(pack.multiple){
        qty=parseInt(document.getElementById(`qty${i}`).value)||1;
      }
      totalPrice += pack.price*qty;
      totalPaid += pack.paid*qty;
      totalFree += pack.free*qty;
      if(pack.coupon && pack.coupon>0){
        const couponCheck=document.getElementById(`coupon${i}`);
        if(couponCheck.checked) totalCoupon += pack.coupon*qty;
      }
    }
  });

  // 有償石パワー計算
  paidPower += Math.floor(totalPaid/50)*40;
  paidRemainder = totalPaid%50;
  paidPower += Math.floor(paidRemainder/5)*4;
  paidRemainder = paidRemainder%5;

  // 無償石パワー計算
  freePower += Math.floor(totalFree/50)*10;
  freeRemainder = totalFree%50;
  freePower += Math.floor(freeRemainder/5)*1;
  freeRemainder = freeRemainder%5;

  // クーポンパワー
  couponPower = totalCoupon*1;

  const totalPower = paidPower + freePower + couponPower;

  const resultDiv=document.getElementById('result');
  resultDiv.innerHTML = `
    <p>合計金額: ￥${totalPrice}</p>
    <p>合計有償石: ${totalPaid} (余り ${paidRemainder}) パワー${paidPower})</p>
    <p>合計無償石: ${totalFree} (余り ${freeRemainder}) パワー${freePower})</p>
    <p>合計ガチャクーポン: ${totalCoupon} パワー${couponPower}</p>
    <p>推定ガチャパワー合計: ${totalPower}</p>
    <button onclick="calculate()">計算し直す</button>
  `;

  // 履歴追加
  const selectedPacks = packs.map((p,i)=>document.getElementById(`pack${i}`).checked?p.name:null).filter(Boolean);
  if(selectedPacks.length>0){
    history.push({packs:selectedPacks,price:totalPrice});
    renderHistory();
  }
}

function renderHistory(){
  const historyDiv=document.getElementById('history');
  historyDiv.innerHTML='';
  history.forEach((h,i)=>{
    historyDiv.innerHTML += `<p>${i+1}: ${h.packs.join(', ')} ￥${h.price}</p>`;
  });
}

function clearHistory(){
  history=[];
  renderHistory();
}

renderPacks();
</script>

</body>
</html>
