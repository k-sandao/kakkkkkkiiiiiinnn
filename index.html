<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>課金計算サイト</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background-color:#f0f0f0; }
  h1,h2 { color: #333; }
  .pack-container { display: flex; flex-wrap: wrap; gap: 15px; }
  .pack-card {
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 15px;
    width: 280px;
    box-shadow: 2px 2px 8px rgba(0,0,0,0.15);
    position: relative;
    transition: opacity 0.3s ease;
    background: #dfefff;
  }
  .pack-card label { display:block; margin-bottom:5px; font-weight:bold; color:#222; }
  .pack-card p { margin: 5px 0; color:#444; }
  .pack-card input[type=number] { width: 60px; margin-left:5px; }
  .buttons { margin-top: 20px; }
  button { margin:5px; padding:8px 12px; border-radius:5px; border:none; background-color:#4CAF50; color:white; cursor:pointer; font-weight:bold; }
  button:hover { background-color:#45a049; }
  .result { margin-top:20px; border-top:2px solid #333; padding:15px; background-color:#fff; border-radius:10px; }
  #history { margin-top:15px; }
  .input-own { margin:10px 0; }
  .input-own label { margin-right:8px; font-weight:bold; }
  .footer-links { margin-top:30px; text-align:center; }
  .footer-links a { margin:0 10px; color:#1a73e8; text-decoration:none; font-weight:bold; }
  .footer-links a:hover { text-decoration:underline; }
  .blue { background-color: #d0e7ff; }
  .orange { background-color: #ffe0c0; }
  .green { background-color: #d0ffd8; }
  .purple { background-color: #e6d0ff; }
  .category {
    margin-bottom: 20px;
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 0 6px rgba(0,0,0,0.1);
    overflow: hidden;
  }
  .category-header {
    background-color: #333;
    color: #fff;
    padding: 10px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .category-content {
    padding: 10px;
  }
  .hidden { display: none; }
  .disabled-mark { pointer-events: none; }
  /* mimic screenshot top inputs style */
  .top-row { margin-bottom: 18px; }
  .top-row label { margin-right: 6px; }
  input[type=number].top-input { width: 80px; margin-right: 12px; }
</style>
</head>
<body>

<h1>課金計算サイト</h1>

<!-- 現在所持している石（スクショと同じ位置・見た目を維持） -->
<h2>現在所持している石</h2>
<div class="input-own top-row">
  <label>有償石:</label><input class="top-input" type="number" id="ownPaid" value="0" min="0">
  <label>無償石:</label><input class="top-input" type="number" id="ownFree" value="0" min="0">
  <label>クーポン:</label><input class="top-input" type="number" id="ownCoupon" value="0" min="0">
  <label style="margin-left:10px;">
    <input type="checkbox" id="includeCoupons" checked> クーポンをガチャパワー計算に含める
  </label>
</div>

<h2>パック選択</h2>
<div id="categories"></div>

<div class="buttons">
  <button onclick="selectAll()">全て購入</button>
  <button onclick="calculate()">計算する</button>
  <button onclick="clearHistory()">履歴クリア</button>
</div>

<div class="result" id="result"></div>

<h2>購入履歴</h2>
<div id="history"></div>

<div class="footer-links">
  <a href="https://youtube.com/@air_player2424" target="_blank">YouTube</a>
  <a href="https://x.com/re62_kn?s=11&t=gadj8VbUyh21lOO3e5edZA" target="_blank">X</a>
</div>

<script>
/* 全パックデータ：青・オレンジ・緑は元のまま残し、紫は unlimited=true のものを数量入力に */
const defaultPacks = [
  // 青（元どおり）
  { name: "魔導石195個パック(アプリ内）", price: 7800, paid: 65, free: 130, color:'blue' },
  { name: "魔導石120個パック(アプリ内）", price: 4800, paid: 40, free: 80, color:'blue' },
  { name: "魔導石75個パック(アプリ内）", price: 3000, paid: 25, free: 50, color:'blue' },
  { name: "魔導石33個パック(アプリ内）", price: 1200, paid: 10, free: 23, color:'blue' },
  { name: "魔導石25個パック(アプリ内）", price: 480, paid: 4, free: 21, color:'blue' },
  { name: "魔導石195個パック（公式ストア）", price: 7800, paid: 65, free: 150, color:'blue' },
  { name: "魔導石120個パック（公式ストア）", price: 4800, paid: 40, free: 92, color:'blue' },
  { name: "魔導石75個パック（公式ストア）", price: 3000, paid: 25, free: 57, color:'blue' },
  { name: "魔導石33個パック（公式ストア）", price: 1200, paid: 10, free: 26, color:'blue' },
  { name: "魔導石25個パック（公式ストア）", price: 480, paid: 4, free: 22, color:'blue' },

  // オレンジ（クーポン）
  { name: "アイドルマスターコラボガチャクーポンDXパック(アプリ内）", price: 4800, paid: 40, free: 0, coupon: 10, color:'orange' },
  { name: "アイドルマスターコラボガチャクーポンSPパック(アプリ内）", price: 2400, paid: 20, free: 0, coupon: 20, color:'orange' },
  { name: "アイドルマスターコラボガチャクーポンパック(アプリ内）", price: 1200, paid: 10, free: 0, coupon: 20, color:'orange' },
  { name: "アイドルマスターコラボガチャクーポンミニパック(アプリ内）", price: 480, paid: 4, free: 0, coupon: 20, color:'orange' },
  { name: "アイドルマスターコラボガチャクーポンDXパック（公式ストア）", price: 4800, paid: 40, free: 12, coupon: 10, color:'orange' },
  { name: "アイドルマスターコラボガチャクーポンSPパック（公式ストア）", price: 2400, paid: 20, free: 6, coupon: 20, color:'orange' },
  { name: "アイドルマスターコラボガチャクーポンパック（公式ストア）", price: 1200, paid: 10, free: 3, coupon: 20, color:'orange' },
  { name: "アイドルマスターコラボガチャクーポンミニパック（公式ストア）", price: 480, paid: 4, free: 1, coupon: 20, color:'orange' },

  // 緑
  { name: "月間公式ストアパック55", price: 1200, paid: 10, free: 45, color:'green' },
  { name: "魔導石50個パック", price: 960, paid: 8, free: 42, color:'green' },
  { name: "月間公式ストアパック300", price: 18000, paid: 150, free: 150, color:'green' },
  { name: "魔導石26個（公式ストア）", price: 3000, paid: 25, free: 1, color:'green' },
  { name: "魔導石43個（公式ストア）", price: 4800, paid: 40, free: 3, color:'green' },
  { name: "魔導石71個（公式ストア）", price: 7800, paid: 65, free: 6, color:'green' },

  // 紫：8個は無制限（数量入力）、2個は1回限り（チェック）
  { name: "魔導石65個(アプリ内）", price: 7800, paid: 65, free: 0, color:'purple', unlimited:true },
  { name: "魔導石40個(アプリ内）", price: 4800, paid: 40, free: 0, color:'purple', unlimited:true },
  { name: "魔導石25個(アプリ内）", price: 3000, paid: 25, free: 0, color:'purple', unlimited:true },
  { name: "魔導石10個(アプリ内）", price: 1200, paid: 10, free: 0, color:'purple', unlimited:true },
  { name: "魔導石4個(アプリ内）", price: 480, paid: 4, free: 0, color:'purple', unlimited:true },
  { name: "魔導石71個(公式ストア）", price: 7800, paid: 65, free: 6, color:'purple', unlimited:true },
  { name: "魔導石43個(公式ストア）", price: 4800, paid: 40, free: 3, color:'purple', unlimited:true },
  { name: "魔導石26個(公式ストア）", price: 3000, paid: 25, free: 1, color:'purple', unlimited:true },
  { name: "スタート応援パック", price: 1200, paid: 10, free: 0, color:'purple', unlimited:false },
  { name: "育成応援パック", price: 480, paid: 4, free: 0, color:'purple', unlimited:false }
];

let history = [];

function renderPacks() {
  const categories = {};
  defaultPacks.forEach(p => {
    if (!categories[p.color]) categories[p.color] = [];
    categories[p.color].push(p);
  });

  const container = document.getElementById("categories");
  container.innerHTML = '';

  const categoryNames = {
    blue: "おまけつき魔導石パック",
    orange: "クーポンパック",
    green: "公式ストア限定パック",
    purple: "石のみパック"
  };

  Object.keys(categories).forEach(color => {
    const catDiv = document.createElement("div");
    catDiv.className = "category";

    const header = document.createElement("div");
    header.className = "category-header";
    header.innerHTML = `${categoryNames[color] || color} <span>▼</span>`;

    const content = document.createElement("div");
    content.className = "category-content";

    const packContainer = document.createElement("div");
    packContainer.className = "pack-container";

    categories[color].forEach((pack, index) => {
      const i = defaultPacks.indexOf(pack);
      let html = `<div class="pack-card ${pack.color}">`;

      if (color === 'purple' && pack.unlimited) {
        // 紫の無制限は数量入力（UIの他要素は変えない）
        html += `
            <label>${pack.name}</label>
            <p>￥${pack.price} | 有償${pack.paid} 無償${pack.free} クーポン${pack.coupon||0}</p>
            <label>購入数: <input type="number" id="qty${i}" min="0" value="0"></label>
        `;
      } else {
        // その他はチェックボックス（紫の unlimited:false もここ）
        html += `
            <input type="checkbox" id="pack${i}">
            <label for="pack${i}">${pack.name}</label>
            <p>￥${pack.price} | 有償${pack.paid} 無償${pack.free} ${pack.coupon ? `| クーポン${pack.coupon}` : ''}</p>
        `;
      }

      html += `</div>`;
      packContainer.innerHTML += html;
    });

    content.appendChild(packContainer);
    catDiv.appendChild(header);
    catDiv.appendChild(content);
    container.appendChild(catDiv);

    // 折りたたみ動作（▲/▼を正しく切り替え）
    header.addEventListener("click", () => {
      content.classList.toggle("hidden");
      const span = header.querySelector("span");
      if (content.classList.contains("hidden")) span.textContent = "▲"; else span.textContent = "▼";
    });
  });

  // 描画後に相互排他イベントをセット（チェックボックスのみ対象）
  setupMutualExclusion();
}

function setupMutualExclusion() {
  const pairs = [
    ["魔導石195個パック(アプリ内）", "魔導石195個パック（公式ストア）"],
    ["魔導石120個パック(アプリ内）", "魔導石120個パック（公式ストア）"],
    ["魔導石75個パック(アプリ内）", "魔導石75個パック（公式ストア）"],
    ["魔導石33個パック(アプリ内）", "魔導石33個パック（公式ストア）"],
    ["魔導石25個パック(アプリ内）", "魔導石25個パック（公式ストア）"],
    ["アイドルマスターコラボガチャクーポンDXパック(アプリ内）", "アイドルマスターコラボガチャクーポンDXパック（公式ストア）"],
    ["アイドルマスターコラボガチャクーポンSPパック(アプリ内）", "アイドルマスターコラボガチャクーポンSPパック（公式ストア）"],
    ["アイドルマスターコラボガチャクーポンパック(アプリ内）", "アイドルマスターコラボガチャクーポンパック（公式ストア）"],
    ["アイドルマスターコラボガチャクーポンミニパック(アプリ内）", "アイドルマスターコラボガチャクーポンミニパック（公式ストア）"]
  ];

  pairs.forEach(([appName, storeName]) => {
    const appIndex = defaultPacks.findIndex(p => p.name === appName);
    const storeIndex = defaultPacks.findIndex(p => p.name === storeName);
    if (appIndex === -1 || storeIndex === -1) return;

    const appCheck = document.getElementById(`pack${appIndex}`);
    const storeCheck = document.getElementById(`pack${storeIndex}`);
    // チェックボックスでない場合は対象外（紫の数量入力など）
    if (!appCheck || !storeCheck) return;

    const appCard = appCheck.closest(".pack-card");
    const storeCard = storeCheck.closest(".pack-card");

    function updateState() {
      if (appCheck.checked) {
        storeCheck.disabled = true;
        if (storeCard) storeCard.style.opacity = "0.5";
        if (storeCard && !storeCard.querySelector(".disabled-mark")) {
          const mark = document.createElement("div");
          mark.textContent = "×";
          mark.classList.add("disabled-mark");
          mark.style.position = "absolute";
          mark.style.top = "5px";
          mark.style.right = "10px";
          mark.style.fontSize = "20px";
          mark.style.color = "red";
          mark.style.fontWeight = "bold";
          storeCard.appendChild(mark);
        }
      } else if (storeCheck.checked) {
        appCheck.disabled = true;
        if (appCard) appCard.style.opacity = "0.5";
        if (appCard && !appCard.querySelector(".disabled-mark")) {
          const mark = document.createElement("div");
          mark.textContent = "×";
          mark.classList.add("disabled-mark");
          mark.style.position = "absolute";
          mark.style.top = "5px";
          mark.style.right = "10px";
          mark.style.fontSize = "20px";
          mark.style.color = "red";
          mark.style.fontWeight = "bold";
          appCard.appendChild(mark);
        }
      } else {
        [appCheck, storeCheck].forEach(chk => chk.disabled = false);
        [appCard, storeCard].forEach(card => {
          if (!card) return;
          card.style.opacity = "1";
          const mark = card.querySelector(".disabled-mark");
          if (mark) mark.remove();
        });
      }
    }

    appCheck.addEventListener("change", updateState);
    storeCheck.addEventListener("change", updateState);
  });
}

function selectAll(){
  defaultPacks.forEach((_,i)=>{
    const checkbox=document.getElementById(`pack${i}`);
    if(checkbox && !checkbox.disabled) checkbox.checked=true;
    const qty = document.getElementById(`qty${i}`);
    if(qty) qty.value = 1; // 紫の数量入力は1にする
  });
}

function calculate(){
  calcAndShow();
}

function calcAndShow(){
  let totalPrice=0, totalPaid=0, totalFree=0, totalCoupon=0;
  const ownPaid=parseInt(document.getElementById('ownPaid').value)||0;
  const ownFree=parseInt(document.getElementById('ownFree').value)||0;
  const ownCoupon=parseInt(document.getElementById('ownCoupon').value)||0;
  totalPaid += ownPaid; totalFree += ownFree; totalCoupon += ownCoupon;

  const includeCoupons = document.getElementById('includeCoupons').checked;

  defaultPacks.forEach((pack,i)=>{
    if (pack.color === 'purple' && pack.unlimited) {
      const qty = parseInt(document.getElementById(`qty${i}`)?.value) || 0;
      if (qty > 0) {
        totalPrice += pack.price * qty;
        totalPaid += (pack.paid || 0) * qty;
        totalFree += (pack.free || 0) * qty;
        if (includeCoupons && pack.coupon) totalCoupon += (pack.coupon || 0) * qty;
      }
    } else {
      const checkbox = document.getElementById(`pack${i}`);
      if (checkbox && checkbox.checked) {
        totalPrice += pack.price;
        totalPaid += (pack.paid || 0);
        totalFree += (pack.free || 0);
        if (includeCoupons && pack.coupon) totalCoupon += (pack.coupon || 0);
      }
    }
  });

  // 元の式を維持：有償50ごとに40、無償50ごとに10、クーポンはそのまま足す
  const totalPower = Math.floor(totalPaid/50)*40 + Math.floor(totalFree/50)*10 + totalCoupon;

  document.getElementById("result").innerHTML = `
    <p>合計金額: ￥${totalPrice.toLocaleString()}</p>
    <p>有償石: ${totalPaid}</p>
    <p>無償石: ${totalFree}</p>
    <p>クーポン: ${totalCoupon} ${includeCoupons ? '' : '(計算に含めない設定)'}</p>
    <p><b>推定ガチャパワー: ${totalPower}</b></p>`;
}

function clearHistory(){
  history=[]; document.getElementById('history').innerHTML='';
}

// イベント：入力変化で自動再計算（UIは変えない）
document.body.addEventListener("input", calcAndShow);
document.getElementById("includeCoupons").addEventListener("change", calcAndShow);

// 初期描画
renderPacks();
calcAndShow();
</script>

</body>
</html>
